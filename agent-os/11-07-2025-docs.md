# EmbedAnythingInDart Documentation Plan
**Created:** November 7, 2025
**Purpose:** Comprehensive user documentation for the EmbedAnythingInDart library

---

## Project Overview

EmbedAnythingInDart is a Dart wrapper for the Rust-based EmbedAnything library, providing high-performance vector embeddings for text and files. This documentation project aims to create user-facing guides that enable developers to quickly understand and effectively use the library.

**Key Facts:**
- FFI-based Dart ↔ Rust bindings using native_toolchain_rs
- Supports BERT and Jina embedding models from HuggingFace
- Text embedding (single and batch) + file/directory embedding with chunking
- Automatic memory management with manual disposal pattern
- Cross-platform: macOS, Linux, Windows (not Web)

---

## Documentation Structure

### 1. Getting Started (`docs/getting-started.md`)
**Agent Assignment:** Agent 1
**Purpose:** Help new users install and create their first embedding

**Required Sections:**
- **Prerequisites:** Dart SDK 3.11+, Rust toolchain 1.90.0
- **Installation:** Add to pubspec.yaml, run `dart pub get`
- **First Example:** Complete code showing model load, embed text, compute similarity, dispose
- **What You Get:** Brief overview of capabilities (text/file embedding, similarity)
- **Next Steps:** Links to other documentation sections

**Code Examples to Include:**
- Complete working example from `example/embedanythingindart_example.dart`
- Simplest possible "Hello World" embedding
- Include console output showing dimension, similarity

**Reference Files:**
- `example/embedanythingindart_example.dart`
- `test/embedanythingindart_test.dart` (basic tests)

---

### 2. Core Concepts (`docs/core-concepts.md`)
**Agent Assignment:** Agent 2
**Purpose:** Explain architecture and fundamental concepts

**Required Sections:**
- **Architecture Overview:** FFI layer, Rust backend, Dart wrapper, native assets
- **Key Classes:**
  - `EmbedAnything` - Main entry point, lifecycle
  - `EmbeddingResult` - Vector representation, operations
  - `ChunkEmbedding` - File embedding results with metadata
  - `ModelConfig` - Configuration objects
- **Memory Management:** Why dispose() is critical, finalizers as backup, try-finally pattern
- **Vector Embeddings 101:** What they are, semantic similarity, cosine similarity range
- **Model Types:** BERT vs Jina characteristics

**Diagrams/Concepts:**
- Lifecycle: Create → Use → Dispose
- Memory ownership: Rust → Dart transfer
- Embedding space visualization (conceptual)

**Reference Files:**
- `lib/src/embedder.dart`
- `lib/src/embedding_result.dart`
- `test/memory_test.dart`
- `CLAUDE.md` (architecture section)

---

### 3. API Reference (`docs/api-reference.md`)
**Agent Assignment:** Agent 3
**Purpose:** Complete API documentation with all signatures

**Required Sections:**

#### **EmbedAnything Class**
- Factory methods: `fromConfig()`, `fromPretrainedHf()`
- Methods: `embedText()`, `embedTextsBatch()`, `embedFile()`, `embedDirectory()`, `dispose()`
- Properties: `config`
- Each entry: signature, parameters, return type, throws, example

#### **EmbeddingResult Class**
- Constructor
- Properties: `values`, `dimension`
- Methods: `cosineSimilarity()`, `toString()`, `==`, `hashCode`
- Each entry with full signature and example

#### **ChunkEmbedding Class**
- Constructor
- Properties: `embedding`, `text`, `metadata`, `filePath`, `page`, `chunkIndex`
- Methods: `cosineSimilarity()`, `toString()`

#### **ModelConfig Class**
- Constructor with all parameters
- Factory methods: `bertMiniLML6()`, `bertMiniLML12()`, `jinaV2Small()`, `jinaV2Base()`
- Methods: `validate()`
- Properties: all fields

#### **Enums**
- `EmbeddingModel`: bert, jina
- `ModelDtype`: f32, f16

**Format:** Follow Dart API doc conventions with `dart` code blocks

**Reference Files:**
- All files in `lib/src/`
- `test/dart_api_test.dart` for usage examples
- `test/factory_methods_test.dart` for config examples

---

### 4. Usage Guide (`docs/usage-guide.md`)
**Agent Assignment:** Agent 4
**Purpose:** Teach common patterns and real-world usage

**Required Sections:**

#### **Pattern 1: Basic Text Embedding**
- Load model with predefined config
- Embed single text
- Access vector and dimension
- Proper disposal

#### **Pattern 2: Batch Processing**
- When to use batch vs individual
- Performance benefits (5-10x speedup)
- Memory considerations

#### **Pattern 3: Semantic Search**
- Embed query text
- Embed candidate texts
- Compute similarities
- Rank by relevance
- Complete working example

#### **Pattern 4: Semantic Clustering**
- Embed multiple items
- Compute pairwise similarities
- Group by similarity threshold

#### **Pattern 5: File Embedding**
- Embed PDF/text files with chunking
- Configure chunk size and overlap
- Process results with metadata
- Use case: document search

#### **Pattern 6: Directory Streaming**
- Efficient directory processing
- Filter by extensions
- Stream processing to avoid memory bloat
- Use case: indexing document collections

#### **Best Practices:**
- Always dispose embedders
- Use batch methods for multiple items
- Choose appropriate chunk sizes
- Cache embeddings for reuse
- Use predefined configs unless customizing

**Reference Files:**
- `example/embedanythingindart_example.dart`
- `test/embedanythingindart_test.dart`
- `test/phase3_integration_test.dart` (file embedding)

---

### 5. Error Handling (`docs/error-handling.md`)
**Agent Assignment:** Agent 5
**Purpose:** Teach robust error handling

**Required Sections:**

#### **Error Hierarchy**
- `EmbedAnythingError` sealed class
- All error types with descriptions:
  - `ModelNotFoundError` - Invalid model ID
  - `InvalidConfigError` - Bad configuration
  - `EmbeddingFailedError` - Embedding operation failed
  - `MultiVectorNotSupportedError` - Unsupported embedding type
  - `FFIError` - FFI layer failure
  - `FileNotFoundError` - File doesn't exist
  - `UnsupportedFileFormatError` - File format not supported
  - `FileReadError` - File read failure

#### **Pattern Matching**
- Complete switch-case example handling all errors
- When/where each error occurs
- Recovery strategies for each

#### **Common Issues & Solutions**
- Model not found → Check HuggingFace Hub, network
- First load slow → Expected, model downloading
- Memory leak suspected → Ensure dispose() called
- Disposed object used → Check disposal logic
- File format errors → Supported formats list

#### **Debugging Tips**
- Enable verbose logging (if available)
- Check model cache: `~/.cache/huggingface/hub`
- Verify network connectivity
- Use try-catch-finally for cleanup

**Reference Files:**
- `lib/src/errors.dart`
- `test/error_test.dart`
- `example/embedanythingindart_example.dart` (error handling)

---

### 6. Models and Configuration (`docs/models-and-configuration.md`)
**Agent Assignment:** Agent 6
**Purpose:** Help users choose and configure models

**Required Sections:**

#### **Available Models**
Table with:
- Model name
- Model ID (HuggingFace)
- Dimension
- Speed (relative)
- Best use case
- Predefined config function

Models:
- BERT MiniLM-L6-v2: 384-dim, fast, general
- BERT MiniLM-L12-v2: 384-dim, better quality
- Jina v2 Small: 512-dim, search-optimized
- Jina v2 Base: 768-dim, highest quality

#### **Predefined Configurations**
- `ModelConfig.bertMiniLML6()` - Recommended starting point
- `ModelConfig.bertMiniLML12()` - Better quality
- `ModelConfig.jinaV2Small()` - Balanced search
- `ModelConfig.jinaV2Base()` - Best quality

#### **Custom Configuration**
- When to customize
- All configuration options explained:
  - `modelId` - HuggingFace identifier
  - `modelType` - Enum: bert or jina
  - `revision` - Git ref (default: 'main')
  - `dtype` - F32 vs F16 tradeoffs
  - `normalize` - Unit normalization (default: true)
  - `defaultBatchSize` - Batch processing size
- Examples of custom configs

#### **Performance Comparison**
- Speed: BERT fastest, Jina slower but higher quality
- Memory: F16 uses ~50% of F32
- Dimension tradeoffs: higher = more precise, slower
- Batch size impact

#### **Model Loading**
- First load: downloads from HuggingFace (slow)
- Cached in `~/.cache/huggingface/hub`
- Subsequent loads: fast (~100-150ms)
- Offline usage after first download

#### **Choosing a Model**
Decision tree:
- General purpose → BERT MiniLM-L6
- Semantic search → Jina v2 Small
- Best quality → Jina v2 Base
- Memory constrained → Use F16 dtype
- Speed critical → BERT with F16

**Reference Files:**
- `lib/src/models.dart`
- `lib/src/model_config.dart`
- `test/model_config_test.dart`
- `test/factory_methods_test.dart`

---

### 7. Advanced Topics (`docs/advanced-topics.md`)
**Agent Assignment:** Agent 7
**Purpose:** Cover advanced usage scenarios

**Required Sections:**

#### **File Embedding Deep Dive**
- Supported formats: PDF, TXT, MD, DOCX, HTML
- Chunking strategies:
  - Fixed-size chunks
  - Overlap ratio for context preservation
  - Optimal chunk sizes by use case
- Metadata extraction and usage
- Batch size tuning for files

#### **Directory Streaming**
- Memory-efficient processing
- Extension filtering
- Progress tracking
- Error handling for individual files
- Use case: Indexing large document collections

#### **Multiple Embedders**
- When to use multiple models
- Memory implications
- Model comparison workflows
- Multi-lingual embedding strategies

#### **Performance Optimization**
- Batch size tuning
- F16 dtype for 2x memory reduction
- Caching embedding results
- Parallel processing strategies
- Benchmarking methodology

#### **Integration Patterns**
- Vector database storage (conceptual)
- Caching layers
- Microservice architecture
- Background processing

#### **Platform Considerations**
- Desktop platforms: macOS, Linux, Windows
- Why Web isn't supported (native binaries)
- Cross-platform consistency testing

#### **Memory Management Deep Dive**
- FFI memory ownership transfer
- NativeFinalizer mechanism
- When to manually dispose vs rely on finalizers
- Memory leak detection
- Testing for memory leaks (reference memory_test.dart)

#### **Edge Cases**
- Empty strings
- Very long text (truncation)
- Unicode and emoji handling
- Multi-language text
- Mixed-length batches
- Whitespace-only text

**Reference Files:**
- `test/phase3_integration_test.dart`
- `test/memory_test.dart`
- `test/edge_cases_test.dart`
- `test/platform_test.dart`
- `CLAUDE.md` (troubleshooting section)

---

## Implementation Guidelines for All Agents

### Code Example Standards
1. **Complete examples:** Include all imports, setup, and cleanup
2. **Real output:** Show expected console output when helpful
3. **Error handling:** Demonstrate try-catch-finally patterns
4. **Comments:** Explain non-obvious code
5. **Testing:** All examples should be verified against actual test code

### Writing Style
- **Clear and concise:** Technical but accessible
- **Active voice:** "You can embed text" not "Text can be embedded"
- **Present tense:** "The method returns" not "The method will return"
- **Code first:** Show example before explaining
- **Practical focus:** Real-world use cases, not just API listing

### Markdown Formatting
- Use `# ` for main title, `## ` for sections, `### ` for subsections
- Code blocks with language: ```dart
- Inline code with backticks: `EmbedAnything`
- Tables for comparisons (models, configs)
- Callout boxes for important notes:
  ```markdown
  > **⚠️ Important:** Always call `dispose()` to prevent memory leaks.
  ```

### Cross-References
- Link between documentation files
- Reference test files with relative paths
- Link to external resources (HuggingFace Hub, etc.)
- Create glossary terms in Core Concepts

### What NOT to Do
- Don't duplicate API reference in usage guide
- Don't assume knowledge of ML/embeddings (explain briefly)
- Don't write TODO sections - only complete documentation
- Don't create examples without verifying against tests

---

## Success Criteria

Each documentation file should:
1. ✅ Stand alone - readable without other docs
2. ✅ Include 3-5 practical code examples
3. ✅ Reference actual test/example code for accuracy
4. ✅ Be technically accurate based on test behavior
5. ✅ Help users solve real problems
6. ✅ Use consistent terminology and formatting
7. ✅ Be complete - no placeholders or TODOs

---

## Source Files Reference

### Test Files (Primary Reference)
- `test/embedanythingindart_test.dart` - Core functionality
- `test/dart_api_test.dart` - Public API usage
- `test/factory_methods_test.dart` - Model configs
- `test/error_test.dart` - Error handling
- `test/memory_test.dart` - Memory management
- `test/edge_cases_test.dart` - Edge cases
- `test/phase3_integration_test.dart` - File embedding
- `test/platform_test.dart` - Platform compatibility
- `test/model_config_test.dart` - Configuration

### Example Application
- `example/embedanythingindart_example.dart` - Complete working example

### Library Source (For API Details)
- `lib/src/embedder.dart` - Main API
- `lib/src/embedding_result.dart` - Result types
- `lib/src/errors.dart` - Error types
- `lib/src/models.dart` - Model enum
- `lib/src/model_config.dart` - Configuration

### Project Documentation
- `CLAUDE.md` - Architecture and development guide
- `README.md` - Project overview
- `docs/readme.md` - Existing docs overview

---

## Agent Instructions

### How to Use This Plan

1. **Read your assigned section** in the structure above
2. **Review reference files** listed for your section
3. **Extract code examples** from test and example files
4. **Write comprehensive documentation** following the guidelines
5. **Verify accuracy** - all examples should match test behavior
6. **Use consistent formatting** as specified above
7. **Cross-reference** other docs when helpful

### Required Context

Each agent should:
- Read this entire plan document first
- Review ALL files in their "Reference Files" section
- Understand the overall project (see Project Overview above)
- Extract real code from tests - don't invent examples
- Test examples mentally against test behavior

### When Complete

Your documentation should:
- Be production-ready user documentation
- Contain no TODOs, placeholders, or "coming soon"
- Have working, verified code examples
- Help users accomplish real tasks
- Be accurate to actual library behavior

---

## Notes

- **Timeline:** All agents work in parallel
- **Coordination:** This document is the single source of truth
- **Questions:** Reference test files as authoritative behavior
- **Quality:** User-facing documentation, not internal notes
- **Audience:** Developers new to the library, familiar with Dart

---

End of plan document.
